# План доработки GhostLayer (Post-MVP)

Документ создан на основе ревью кода и обсуждения с пользователем.

## 1. Технический долг и "Гигиена" (Приоритет: Высокий)
- [x] **Заменить `print()` на `logger`**: В файле `src/processing/regex_rules.py` (строка ~83) используется `print()` для вывода ошибок. Это нужно исправить на `logger.error()`.
- [x] **Очистка корневой директории**: Удалить лишние `.spec` файлы (`ghostlayer.spec`, `GhostLayer_Final.spec`, `GhostLayer_v2.spec`, `GhostLayer_v3.spec`, `GhostLayer_v4.spec`), оставив `GhostLayer_Final_v2.spec` как актуальный.
- [x] **Версионирование**: Зафиксировать версии библиотек в `requirements.txt` (особенно `flet`), чтобы избежать проблем при обновлениях зависимостей.

## 2. Исправление UX/Багов (Приоритет: Высокий)
- [x] **Проверка поддержки DOCX**:
    - Ревьюер отметил отсутствие поддержки DOCX.
    - Проверено: `src/ui/file_handlers.py` и `FilePicker` в `src/ui/main_window.py` содержат `.docx` в `allowed_extensions`. UI (`DropArea`) также явно упоминает DOCX. Поддержка реализована корректно.

## 3. Новые функции (Стратегия развития)

### 3.1. Обратная деанонимизация (Re-identification)
**Цель**: Позволить пользователю восстановить скрытые данные в тексте, сгенерированном ИИ.
**Концепция**:
1. Пользователь копирует анонимизированный текст и отправляет в ИИ.
2. ИИ генерирует ответ, сохраняя маски (например, "Согласно договору с [COMPANY_1]...").
3. Пользователь вставляет этот ответ в GhostLayer.
4. GhostLayer автоматически заменяет `[COMPANY_1]` на оригинальное название, используя данные текущей сессии или сохраненный ключ.

**Задачи**:
- [x] Разработать UI для "Обратной деанонимизации" (отдельная вкладка или окно ввода). (`src/ui/reidentification_panel.py`)
- [x] Интегрировать панель в `MainWindow` и добавить кнопку активации в `CommandCenter`.
- [x] Реализовать логику восстановления (`_on_reidentify_request` в `MainWindow`).
- [ ] (Опционально) Реализовать экспорт/импорт карты замен (json файл) для восстановления сессии после перезапуска.

### 3.2. Пользовательские плейсхолдеры
**Цель**: Дать возможность задавать смысловые имена маскам.
**Пример**: Вместо `[PERSON_1]` пользователь может переименовать маску в `[ДИРЕКТОР]` или `[КЛИЕНТ]`.
**Задачи**:
- [ ] Добавить возможность редактирования лейбла маски в `InspectorPanel` или через контекстное меню.

## 4. Оптимизация (Приоритет: Средний)
- [ ] **Кэширование Regex**: Компилировать регулярные выражения один раз при старте, а не при каждом запуске пайплайна.
- [ ] **Оптимизация SplitView**: Рассмотреть возможность виртуализации списка для очень больших текстов (хотя текущее решение с `TextSpan` уже решило проблему производительности).

---
*Последнее обновление: 13.12.2025*
